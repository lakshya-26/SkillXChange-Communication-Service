generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Conversation {
  id              Int       @id @default(autoincrement())
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @default(now()) @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  participants    ConversationParticipant[]
  messages        Message[]

  @@map("conversations")
}

model ConversationParticipant {
  id              Int       @id @default(autoincrement())
  conversationId  Int
  userId          Int      @map("user_id")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @default(now()) @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  conversation    Conversation @relation(fields: [conversationId], references: [id])

  @@unique([conversationId, userId]) // each user only once per chat
  @@map("conversation_participants")
}

model Message {
  id              Int       @id @default(autoincrement())
  conversationId  Int
  senderId        Int
  content         String    // message text
  messageType     MessageType @default(TEXT) @map("message_type")
  readAt          DateTime? @map("read_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  deletedAt       DateTime? @map("deleted_at")

  conversation    Conversation @relation(fields: [conversationId], references: [id])

  @@map("messages")
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  SIGNAL // For WebRTC signaling later
}
